<!DOCTYPE html>
<html>
<head>
<title>Objects Recognition</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<style>
  body {
    margin: 0;
    background-color: #f0f0f0;
    text-align: center;
    font-family: Arial, sans-serif;
  }
  h3 {
    margin-top: 20px;
  }
  video {
    width: 50vw;
    height: auto;
    border: 4px solid #333;
    border-radius: 10px;
    margin-top: 20px;
  }
  #label {
    font-size: 24px;
    margin-top: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>
<h3>Objects Recognition (Phone Camera)</h3>
<video id="video" autoplay muted></video>
<p id="label">Detecting...</p>

<script>
const video = document.getElementById("video");
const label = document.getElementById("label");
let lastObject = "";

async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
}

async function loadModelAndDetect() {
  const model = await cocoSsd.load();
  setInterval(async () => {
    const predictions = await model.detect(video);
    if (predictions.length > 0) {
      const object = predictions[0].class;
      if (object !== lastObject) {
        lastObject = object;
        label.innerText = `Detected: ${object}`;
        speak(object);
        sendToNodeMCU(object);
      }
    }
  }, 3000);
}

function speak(text) {
  const msg = new SpeechSynthesisUtterance(`I see a ${text}`);
  speechSynthesis.speak(msg);
}

function sendToNodeMCU(obj) {
  fetch(`http://192.168.4.1/detect?object=${obj}`)
    .then(res => console.log("Sent to NodeMCU:", obj))
    .catch(err => console.error("Error:", err));
}

startCamera().then(loadModelAndDetect);
</script>
</body>
</html>
